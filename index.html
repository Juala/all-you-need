<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Layanan By Roja</title>
<style>
body{font-family:Arial, sans-serif;background:#f5f5f5;padding:20px;margin:0;}
.container{max-width:450px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
h2{text-align:center;margin-bottom:20px;color:#333;}
label{font-weight:bold;margin-top:10px;display:block;}
input,select,button{width:100%;padding:10px;margin-top:5px;border:1px solid #ccc;border-radius:8px;font-size:15px;}
button{background:#007bff;color:#fff;border:none;margin-top:20px;font-size:16px;font-weight:bold;cursor:pointer;}
button:hover{background:#0066d6;}
#loadingFast{display:none;text-align:center;color:#007bff;margin-top:10px;font-weight:bold;}
</style>
</head>

<body>
<div class="container">
<h2>Order Layanan</h2>

<label>Layanan</label>
<select id="layanan">
<option value="">-- Pilih Layanan --</option>
<option value="Biasa">Layanan Biasa</option>
<option value="FAST">FAST Rekomendet</option>
</select>

<label>Produk</label>
<select id="produk">
<option value="">Pilih Layanan Terlebih Dahulu</option>
</select>

<div id="loadingFast">Mengambil produk FAST...</div>

<label>Jumlah</label>
<input type="number" id="jumlah" placeholder="Masukkan jumlah">

<label>Nomor WhatsApp</label>
<input type="number" id="wa" placeholder="628xxxxxx" />

<label>Username / Link</label>
<input type="text" id="username" placeholder="Opsional untuk layanan FAST">

<label>Total Harga</label>
<input type="text" id="harga" readonly />

<button onclick="buatPesanan()">Pesan Sekarang</button>

</div>

<script>
// API PremiumKu
const API_KEY = "6ce970a90c5663043e8958ee251a7160";

const layanan = document.getElementById("layanan");
const produk = document.getElementById("produk");
const jumlah = document.getElementById("jumlah");
const harga = document.getElementById("harga");
const loadingFast = document.getElementById("loadingFast");

// Harga manual layanan biasa (tidak diubah)
const hargaLayananBiasa = {
    "Spotify 1 Bulan": 15000,
    "Capcut Pro": 10000,
    "ML Starlight": 30000
};

// Ketika layanan dipilih
layanan.addEventListener("change", async function() {

    // Reset harga
    harga.value = "";

    if(layanan.value === "FAST"){
        produk.innerHTML = `<option>Memuat...</option>`;
        loadingFast.style.display = "block";

        // ambil produk FAST dari PremiumKu
        let res = await fetch("https://premiumku.store/api/products", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ api_key: API_KEY })
        });

        let data = await res.json();

        loadingFast.style.display = "none";

        if(!data.success){
            produk.innerHTML = `<option>Gagal ambil produk FAST</option>`;
            return;
        }

        produk.innerHTML = `<option value="">-- Pilih Produk FAST --</option>`;

        data.products.forEach(p=>{
            produk.innerHTML += `
                <option value="${p.id}" data-harga="${p.price}">
                    ${p.name} - Rp ${p.price}
                </option>`;
        });

    } else {
        // Layanan biasa
        produk.innerHTML = `
            <option value="">-- Pilih Produk --</option>
            <option value="Spotify 1 Bulan">Spotify 1 Bulan</option>
            <option value="Capcut Pro">Capcut Pro</option>
            <option value="ML Starlight">ML Starlight</option>
        `;
    }
});

// Hitung harga otomatis
produk.addEventListener("change", function(){
    if(layanan.value === "FAST"){
        let opt = produk.options[produk.selectedIndex];
        let h = Number(opt.getAttribute("data-harga") || 0);
        harga.value = "Rp " + h.toLocaleString("id-ID");
    } else {
        harga.value = "Rp " + (hargaLayananBiasa[produk.value] || 0).toLocaleString("id-ID");
    }
});

// Proses Order
function buatPesanan(){

    if(!layanan.value){ alert("Pilih layanan!"); return; }
    if(!produk.value){ alert("Pilih produk!"); return; }
    if(!jumlah.value){ alert("Masukkan jumlah!"); return; }
    if(!wa.value){ alert("Nomor WA wajib!"); return; }

    const p = produk.options[produk.selectedIndex];
    const hargaAsli = layanan.value === "FAST"
        ? Number(p.getAttribute("data-harga"))
        : hargaLayananBiasa[produk.value];

    // Redirect ke paymentfast untuk layanan FAST
    if(layanan.value === "FAST"){
        window.location.href =
          `paymentfast.html?orderId=ROJA-${Date.now()}&product=${p.text}&jumlah=${jumlah.value}&phone=${wa.value}&username=${username.value}&harga=${hargaAsli}`;
        return;
    }

    // Redirect ke payment biasa
    window.location.href =
      `payment.html?orderId=ROJA-${Date.now()}&product=${produk.value}&jumlah=${jumlah.value}&phone=${wa.value}&username=${username.value}&harga=${hargaAsli}`;
}
</script>

</body>
</html>
