<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment | ROJA STORE</title>
<style>
body { font-family:Poppins, Arial, sans-serif; background:#f4f7fc; margin:0; padding:0; }
.container { max-width:500px; margin:50px auto; background:#fff; padding:25px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.1);}
h2 { text-align:center; font-weight:700; color:#2d2d2d; margin-bottom:15px;}
.info-box { margin-top:20px; padding:15px; border-radius:10px; background:#eef3ff; border:1px solid #cdd8ff; }
p { font-size:15px; margin:6px 0; }
.value { font-weight:bold; color:#004aad; }
.qris-box { margin-top:20px; text-align:center; }
.qris-box img { border-radius:10px; border:1px solid #ddd; width:250px; }
button { background:#007bff; width:100%; padding:14px; color:white; border:none; border-radius:10px; font-size:17px; font-weight:600; cursor:pointer; margin-top:18px; }
button:hover { background:#005fcc; }
#btnOrderAgain { background:#28a745; margin-top:10px; }
.input-box { margin-top:20px; }
input { width:100%; padding:12px; font-size:16px; border-radius:10px; border:1px solid #bbb; }
</style>
</head>
<body>

<div class="container">
  <h2>Konfirmasi Pembayaran FAST</h2>

  <div class="info-box">
    <p><strong>Order ID:</strong> <span id="orderId" class="value"></span></p>
    <p><strong>Produk:</strong> <span id="produk" class="value"></span></p>
    <p><strong>Jumlah:</strong> <span id="jumlah" class="value"></span></p>
    <p><strong>Nomor WhatsApp:</strong> <span id="phone" class="value"></span></p>
    <p><strong>Total Pembayaran:</strong> <span id="harga" class="value"></span></p>
  </div>

  <div class="qris-box">
    <p>Silakan Scan QRIS untuk melanjutkan pembayaran.</p>
    <img src="qris.png" alt="QRIS">
  </div>

  <button onclick="kirimWA()">Konfirmasi ke Admin</button>

  <!-- Kolom untuk memasukkan kode admin -->
  <div class="input-box">
    <p><strong>Kode dari Admin:</strong></p>
    <input type="text" id="kodeAdmin" placeholder="Tempel kode dari admin di sini...">
  </div>

  <button style="background:#ff7b00;" onclick="prosesPremiumKu()">Proses ke PremiumKu</button>

  <button id="btnOrderAgain" onclick="pesanLagi()">Pesan Lagi</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDpj7udfBLEqlloEqidlSJYHt-2icTOGCw",
  authDomain: "database-jualan.firebaseapp.com",
  databaseURL: "https://database-jualan-default-rtdb.firebaseio.com",
  projectId: "database-jualan",
  storageBucket: "database-jualan.appspot.com",
  messagingSenderId: "766732892106",
  appId: "1:766732892106:web:cd223204bfbb529599c133"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Ambil parameter URL
const params = new URLSearchParams(window.location.search);
const orderId = params.get("orderId") || `ROJA-${Date.now()}`;
const product = params.get("product");
const jumlah = params.get("jumlah");
const phone = params.get("phone");
const hargaTotal = params.get("harga");
const productId = params.get("productId"); // untuk API fast

// Tampilkan ke UI
document.getElementById("orderId").textContent = orderId;
document.getElementById("produk").textContent = product;
document.getElementById("jumlah").textContent = jumlah;
document.getElementById("phone").textContent = phone;
document.getElementById("harga").textContent = "Rp " + Number(hargaTotal).toLocaleString("id-ID");

// Kirim ke Firebase
set(ref(db, "orders_fast/" + orderId), {
  id: orderId,
  whatsapp: phone,
  produk: product,
  jumlah: jumlah,
  total: hargaTotal,
  status: "Pending",
  fastProductId: productId
});

// Tombol konfirmasi WA
window.kirimWA = function(){
  let waMsg = `Halo Admin, saya ingin konfirmasi pembayaran FAST.\n\nOrder ID: ${orderId}\nProduk: ${product}\nJumlah: ${jumlah}\nNomor: ${phone}\nTotal: Rp ${Number(hargaTotal).toLocaleString("id-ID")}\n\nTolong kirimkan kode untuk melanjutkan.`;
  window.open(`https://wa.me/6282262642007?text=${encodeURIComponent(waMsg)}`, "_blank");
}

// Tombol pesan lagi
window.pesanLagi = function(){ window.location.href = "index.html"; }

// PROSES ORDER KE PREMIUMKU
window.prosesPremiumKu = async function(){

  const kode = document.getElementById("kodeAdmin").value.trim();
  if(kode === ""){
    alert("Masukkan kode dari admin terlebih dahulu!");
    return;
  }

  const body = {
    api_key: "6ce970a90c5663043e8958ee251a7160",
    product_id: Number(productId),
    phone: phone,
    note: kode
  };

  try {
    const res = await fetch("https://premiumku.store/api/order", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify(body)
    });

    const data = await res.json();

    if(data.success){
      alert("Order Fast Berhasil! Silakan cek WhatsApp Anda.");
    } else {
      alert("Gagal memproses order: " + data.message);
    }

  } catch(err){
    alert("Terjadi kesalahan koneksi.");
  }
}

</script>

</body>
</html>
